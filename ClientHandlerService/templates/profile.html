{% extends "base.html" %}

{% block content %}
<div class="monitoring-container">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div class="monitoring-header">
        <h1>{{sitename}}</h1>
        <div class="controls">
            <button class="refresh-btn" onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        {% if pings %}
        {{form.hidden_tag()}}
        <form action="" class="search-form" method="post" novalidate>
            {{ form.sub(class="add-site-btn")}}
        </form>
        {% endif %}
        {%if admin%}

        {{ formssl.hidden_tag() }}
            <form action="" class="refresh-btn" method="post" novalidate>
                {{ formssl.sll(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
            </form>
        {{ formhtp.hidden_tag() }}
            <form action="" class="refresh-btn" method="post" novalidate>
                {{ formhtp.htt(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
            </form>
        {{ formmed.hidden_tag() }}
            <form action="" class="refresh-btn" method="post" novalidate>
                {{ formmed.med(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
            </form>
        <div class="search-container">
            {{ formpri.hidden_tag() }}
            <form action="" class="search-form" method="post" novalidate>
                <div class="select">
                    {{ formpri.pri(class="select", placeholder="") }}
                    {{ formpri.pris(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
                </div>
                {% for error in form3.content.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </form>

 {% endif %}
        </div>
    </div>
    <div class="monitoring-header">
        <div class="chart-container">
            <canvas id="myChart"></canvas>
        </div>
        {%if admin%}
        <div class="search-container">
            <text> {{ctn}} </text>
            {{ form3.hidden_tag() }}
            <form action="" class="search-form" method="post" novalidate>
                <div class="search-group">
                    {{ form3.content(class="search-input", placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç") }}
                    {{ form3.set(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
                </div>
                {% for error in form3.content.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </form>
            <text> {{ctn_type}} </text>
            {{ form4.hidden_tag() }}
            <form action="" class="search-form" method="post" novalidate>
                <div class="search-group">
                    {{ form4.type(class="search-input", placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∏–ø –∏—Å–∫–æ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞") }}
                    {{ form4.use(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
                </div>
                {% for error in form4.type.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </form>
            <text> {{pth}} </text>
            {{ formpat.hidden_tag() }}
            <form action="" class="search-form" method="post" novalidate>
                <div class="search-group">
                    {{ formpat.path(class="search-input", placeholder="–í–≤–µ–¥–∏—Ç–µ path") }}
                    {{ formpat.pat(class="add-site-btn", placeholder="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")}}
                </div>
                {% for error in formpat.path.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </form>

        </div>

        {%endif%}
    </div>
    <div class="monitoring-table">
        <table>
            <thead>
            <tr>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</th>
                <th>–ö–æ–¥</th>
                <th>–û—à–∏–±–∫–∏</th>
            </tr>
            </thead>
            <tbody>
            {% for ping in pings %}
            <tr class="status-{{ ping.status }}">
                <td class="status">
                        <span class="status-badge status-{{ ping.status }}">
                            {% if ping.status == 'up' %}
                                ‚úÖ Online
                            {% else %}
                                ‚ùå Offline
                            {% endif %}
                        </span>
                </td>
                <td class="response-time">
                    {{ ping.response_time }}ms
                </td>
                <td class="timestamp">
                    {{ ping.timestamp }}
                </td>
                <td class="status">
                    {{ ping.ans }}
                </td>
                <td class="status">
                    {{ ping.error }}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% if not pings %}
    <div class="empty-state">
        <div class="empty-icon">üì°</div>
        <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h3>
        <p>–î–æ–±–∞–≤—å—Ç–µ —Å–∞–π—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</p>
        <form action="" class="login-form" method="post" novalidate>
            {{form2.hidden_tag()}}
            {{ form2.add(class="add-site-btn", placeholder="‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∞–π—Ç")}}
        </form>
    </div>
    {% endif %}
</div>

<style>
    .monitoring-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .monitoring-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 20px;
    }

     .chart-container {
                position: relative;
                height: 400px;
                width: 100%;
                max-width: 2000px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

    .monitoring-header h1 {
        color: #667eea;
        font-size: 2.2em;
    }
select {
  appearance: none; /* —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ */
  -webkit-appearance: none;
  -moz-appearance: none;

  background: linear-gradient(135deg, #7d5fff, #6a11cb);
  color: white;
  font-size: 16px;
  font-weight: 500;
  padding: 10px 15px;
  border: 2px solid #5a0fbf;
  border-radius: 25px;
  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  width: 250px; /* –º–æ–∂–Ω–æ –ø–æ–¥–æ–≥–Ω–∞—Ç—å –ø–æ–¥ —Ç–≤–æ–π –º–∞–∫–µ—Ç */
  text-align: center;
}

select:hover {
  background: linear-gradient(135deg, #8f6fff, #7a1fe0);
  box-shadow: 0 0 8px rgba(122, 31, 224, 0.5);
}

select:focus {
  border-color: #a34bff;
  box-shadow: 0 0 10px rgba(163, 75, 255, 0.6);
}

option {
  background: #fff;
  color: #333;
}
    .controls {
        display: flex;
        gap: 15px;
        align-items: center;
    }
    .search-container {
            max-width: 2000px;
            margin: 0 auto;
        }

        .search-form {
            width: 200%;
        }

        .search-group {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #ddd;
            border-radius: 50px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .search-group:focus-within {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            outline: none;
            font-size: 1.1em;
            background: transparent;
        }

        .search-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateX(2px);
        }

        .search-icon {
            font-size: 1.2em;
        }


    .refresh-btn, .filter-select {
        padding: 10px 20px;
        border: 2px solid #667eea;
        border-radius: 25px;
        background: white;
        color: #667eea;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease;
    }

    .refresh-btn:hover {
        background: #667eea;
        color: white;
    }

    .filter-select {
        padding: 10px 15px;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .stat-icon {
        font-size: 2em;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        color: white;
    }

    .stat-info h3 {
        font-size: 1.8em;
        color: #333;
        margin: 0;
    }

    .stat-info p {
        color: #666;
        margin: 5px 0 0 0;
    }

    .monitoring-table {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        overflow-x: auto;
    }

    .monitoring-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .monitoring-table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: bold;
    }

    .monitoring-table td {
        padding: 15px;
        border-bottom: 1px solid #eee;
    }

    .monitoring-table tr:hover {
        background-color: #f8f9ff;
    }

    .monitoring-table tr:last-child td {
        border-bottom: none;
    }

    .site-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .favicon {
        font-size: 1.5em;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f0f4ff;
        border-radius: 8px;
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
    }

    .status-success .status-badge {
        background: #e8f5e8;
        color: #2e7d32;
    }

    .status-error .status-badge {
        background: #ffebee;
        color: #c62828;
    }

    .response-time {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        color: #666;
    }

    .timestamp {
        color: #888;
        font-size: 0.9em;
    }

    .actions {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 15px;
        background: white;
        color: #666;
        cursor: pointer;
        font-size: 0.8em;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .empty-icon {
        font-size: 4em;
        margin-bottom: 20px;
    }

    .empty-state h3 {
        color: #667eea;
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #666;
        margin-bottom: 30px;
    }

    .add-site-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .add-site-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    @media (max-width: 768px) {
        .monitoring-header {
            flex-direction: column;
            text-align: center;
        }

        .stats-cards {
            grid-template-columns: 1fr;
        }

        .stat-card {
            flex-direction: column;
            text-align: center;
        }

        .actions {
            flex-direction: column;
        }

        .monitoring-table {
            font-size: 0.9em;
        }

        .site-info {
            flex-direction: column;
            text-align: center;
            gap: 8px;
        }
    }
</style>

<script>
    function refreshData() {
        location.reload();
    }
    const time = JSON.parse('{{ time | tojson | safe}}');
    const delay = JSON.parse('{{ delay | tojson |safe}}');

    const data = {
                labels: time,
                datasets: [{
                    label: '–ó–∞–¥–µ—Ä–∂–∫–∏ (–º—Å)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: delay,
                    tension: 0.2,
                    fill: false
                }]
            };

    const config = {
                type: 'line',
                data: data,
                options: {
                    maintainAspectRatio: false,

                    plugins: {
                        title: {
                            display: true,
                            text: '–ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ –æ—Ç–≤–µ—Ç–∞ —Å–∞–π—Ç–∞'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: '–ó–∞–¥–µ—Ä–∂–∫–∞ (–º—Å)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–í—Ä–µ–º—è'
                            }
                        }
                    }
                }
            };

    window.addEventListener('load', function() {
                const ctx = document.getElementById('myChart').getContext('2d');
                const myChart = new Chart(ctx, config);
            });

</script>
{% endblock %}